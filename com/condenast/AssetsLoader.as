package com.condenast{import flash.display.Sprite;import flash.display.Loader;import flash.net.URLRequest;import flash.system.Security;import flash.system.LoaderContext;import flash.system.ApplicationDomain;import flash.system.SecurityDomain;import flash.events.IOErrorEvent;import flash.events.Event;	public class AssetsLoader extends Sprite{		private var _api:Object;		private var _metrics:Object;		private var _contentMetrics:Object;		private var _config:Object;		private var mc:Sprite;		private var _path:String;				private var _debug:Boolean;    	public function AssetsLoader(_api:Object = null, _config:Object = null) {			this._api = _api;			this._config = _config;    	}		public function init($debug:Boolean):void{			_debug = $debug;			mc = new Sprite;			if(!_debug) _path = _config.getString("assets");			loadSWF();		}		public function setMetrics(_metrics:Object):void{			this._metrics = _metrics;		}				//loads assets				private function loadSWF():void{			var l:Loader = new Loader();			if(!_debug){				Security.allowDomain('*');				var policyFile = (_path.split("origin").length == 2)?"http://origin.ads.thestudio.condenast.com/crossdomain.xml":"http://ads.thestudio.condenast.com/crossdomain.xml";				Security.loadPolicyFile(policyFile);				var context:LoaderContext = new LoaderContext(false, new ApplicationDomain(ApplicationDomain.currentDomain), SecurityDomain.currentDomain);				if(_path != '') l.load(new URLRequest(_path), context);			}			if(_debug) l.load(new URLRequest('assets/assets.swf'));						l.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,function():void{});			l.contentLoaderInfo.addEventListener(Event.COMPLETE, function($e:Event):void{ 				var _swf:ISwf = ISwf($e.target.content);				var ctn:Sprite = Sprite(_swf);				_swf._init(initializeProduct);			});		}				private function initializeProduct(lib):void{			var p:Product = new Product(lib, track);			mc.addChild(p);			addChild(mc);		}				//tracking				private function track(type:String, s:String):void{			var trigger:Object;			if(type == 'click'){				trigger = _metrics.logInteraction(          			_metrics.subtype.INTERACTION_SELECT_SUBTYPE,					_metrics.mode.MODE_CLICK,          			s, {});				_contentMetrics = trigger;			}						if(type == 'hover'){				trigger = _metrics.logInteraction(          			_metrics.subtype.INTERACTION_SELECT_SUBTYPE,					_metrics.mode.MODE_ROLLOVER,          			s, {});				_contentMetrics = trigger;			}						if(type == 'custom'){				trigger = (_contentMetrics != null)?					_contentMetrics.logInteraction(          				_metrics.subtype.INTERACTION_COMPONENT_SUBTYPE,						_metrics.mode.MODE_UNKNOWN,          			s, {}):					_metrics.logInteraction(          				_metrics.subtype.INTERACTION_COMPONENT_SUBTYPE,						_metrics.mode.MODE_UNKNOWN,          			s, {});			}						if(type == 'message'){				_api.message.sendMessage(s); 			}						if(type == 'navigateToURL'){				_api.net.navigateToURL(s, {window:"_blank"}, trigger);			}				}	}}